<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Auth Debug - SyncedUp Insurance</title>
    <style>
        body { 
            font-family: Arial, sans-serif; 
            padding: 20px; 
            background: #f5f5f5;
        }
        .debug-container {
            max-width: 800px;
            margin: 0 auto;
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .debug-section {
            margin: 20px 0;
            padding: 15px;
            border: 1px solid #ddd;
            border-radius: 4px;
            background: #f8f9fa;
        }
        .pass { border-color: #28a745; background: #d4edda; }
        .fail { border-color: #dc3545; background: #f8d7da; }
        button {
            background: #007bff;
            color: white;
            border: none;
            padding: 10px 15px;
            margin: 5px;
            border-radius: 4px;
            cursor: pointer;
        }
        button:hover { background: #0056b3; }
        pre {
            background: #f1f1f1;
            padding: 10px;
            border-radius: 4px;
            overflow-x: auto;
            font-size: 12px;
        }
        .status {
            font-weight: bold;
            padding: 5px 10px;
            border-radius: 4px;
            display: inline-block;
            margin: 5px 0;
        }
        .status.ok { background: #d4edda; color: #155724; }
        .status.error { background: #f8d7da; color: #721c24; }
    </style>
</head>
<body>
    <div class="debug-container">
        <h1>üîç Authentication Debug Tool</h1>
        <p>This tool helps debug authentication issues for SyncedUp Insurance.</p>

        <div class="debug-section">
            <h3>Current Authentication Status</h3>
            <div id="auth-status"></div>
            <button onclick="checkAuth()">Refresh Auth Status</button>
            <button onclick="clearStorage()">Clear All Storage</button>
        </div>

        <div class="debug-section">
            <h3>Local Storage Contents</h3>
            <div id="storage-contents"></div>
            <button onclick="showStorage()">Show All Storage</button>
        </div>

        <div class="debug-section">
            <h3>Test Access</h3>
            <button onclick="testAdmin()">Test Admin Access</button>
            <button onclick="testLeaderboard()">Test Leaderboard Access</button>
            <button onclick="testLogin()">Go to Login</button>
            <div id="test-results"></div>
        </div>

        <div class="debug-section">
            <h3>Manual Token Entry</h3>
            <p>If you have a valid token, enter it here:</p>
            <input type="text" id="manual-token" placeholder="Enter token" style="width: 300px; padding: 5px;">
            <input type="text" id="manual-user" placeholder="Enter user JSON" style="width: 300px; padding: 5px; margin-top: 5px;"><br>
            <button onclick="setManualAuth()">Set Manual Auth</button>
        </div>
    </div>

    <script>
        function checkAuth() {
            const token = localStorage.getItem('syncedup_token');
            const userStr = localStorage.getItem('syncedup_user');
            const statusDiv = document.getElementById('auth-status');
            
            let html = '';
            
            if (!token) {
                html += '<div class="status error">‚ùå No Token Found</div><br>';
            } else {
                html += '<div class="status ok">‚úÖ Token Exists</div><br>';
                html += `<pre>Token: ${token.substring(0, 50)}...</pre>`;
            }
            
            if (!userStr) {
                html += '<div class="status error">‚ùå No User Data Found</div><br>';
            } else {
                html += '<div class="status ok">‚úÖ User Data Exists</div><br>';
                try {
                    const user = JSON.parse(userStr);
                    html += '<pre>' + JSON.stringify(user, null, 2) + '</pre>';
                    
                    const role = user.role || '';
                    const allowed = ['agent','manager','admin','super_admin','customer_service','super-admin','customer-service'];
                    
                    if (allowed.includes(role)) {
                        html += '<div class="status ok">‚úÖ Role Valid: ' + role + '</div>';
                    } else {
                        html += '<div class="status error">‚ùå Invalid Role: ' + role + '</div>';
                    }
                } catch (e) {
                    html += '<div class="status error">‚ùå Invalid User JSON</div>';
                    html += '<pre>Error: ' + e.message + '</pre>';
                }
            }
            
            statusDiv.innerHTML = html;
        }

        function showStorage() {
            const div = document.getElementById('storage-contents');
            let html = '<pre>';
            
            for (let i = 0; i < localStorage.length; i++) {
                const key = localStorage.key(i);
                const value = localStorage.getItem(key);
                html += key + ': ' + value + '\n';
            }
            
            html += '</pre>';
            div.innerHTML = html;
        }

        function clearStorage() {
            if (confirm('Clear all localStorage? This will log you out.')) {
                localStorage.clear();
                checkAuth();
                showStorage();
            }
        }

        function testAdmin() {
            const resultsDiv = document.getElementById('test-results');
            resultsDiv.innerHTML = 'Testing admin access...';
            
            setTimeout(() => {
                window.open('/admin', '_blank');
                resultsDiv.innerHTML = 'Opened admin page in new tab. Check if it redirects to login.';
            }, 500);
        }

        function testLeaderboard() {
            const resultsDiv = document.getElementById('test-results');
            resultsDiv.innerHTML = 'Testing leaderboard access...';
            
            setTimeout(() => {
                window.open('/leaderboard/', '_blank');
                resultsDiv.innerHTML = 'Opened leaderboard page in new tab. Check if it redirects to login.';
            }, 500);
        }

        function testLogin() {
            window.open('/login.html', '_blank');
        }

        function setManualAuth() {
            const token = document.getElementById('manual-token').value;
            const userJson = document.getElementById('manual-user').value;
            
            if (token) {
                localStorage.setItem('syncedup_token', token);
            }
            
            if (userJson) {
                try {
                    JSON.parse(userJson); // Validate JSON
                    localStorage.setItem('syncedup_user', userJson);
                } catch (e) {
                    alert('Invalid user JSON: ' + e.message);
                    return;
                }
            }
            
            checkAuth();
            alert('Manual auth set. Try accessing pages now.');
        }

        // Auto-run on page load
        checkAuth();
        showStorage();
    </script>
</body>
</html>
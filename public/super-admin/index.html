<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>System Administration - SyncedUp Insurance</title>
    
    <!-- Favicons -->
    <link rel="icon" type="image/png" sizes="50x50" href="/favicons/favicon-50x50.png">
    <link rel="apple-touch-icon" sizes="180x180" href="/favicons/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="512x512" href="/favicons/android-chrome-512x512.png">
    
    <!-- Charts -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://unpkg.com/lucide@latest/dist/umd/lucide.js"></script>
    
    <!-- Super Admin Global Styles -->
    <link rel="stylesheet" href="/super-admin/super-admin-global.css">
</head>
<body>
    <!-- Header -->
    <header class="header">
        <div class="header-content">
            <a href="index.html" class="logo">
                <div class="logo-icon">SA</div>
                Super Admin Portal
            </a>
            <div class="header-actions">
                <div class="user-info">
                    <div class="user-avatar">SA</div>
                    <div>
                        <div style="font-weight: 600;" id="userDisplay">Super Admin</div>
                        <div style="font-size: 0.8rem; opacity: 0.7;">Platform Administrator</div>
                    </div>
                </div>
                <button class="btn" onclick="logout()">
                    <i data-lucide="log-out"></i>
                    Logout
                </button>
            </div>
        </div>
    </header>

    <!-- Navigation -->
    <nav class="nav">
        <div class="nav-section">
            <div class="nav-title">Platform Overview</div>
            <a href="index.html" class="nav-link active">
                <i data-lucide="layout-dashboard" class="nav-icon"></i>
                Dashboard
            </a>
            <a href="system-analytics.html" class="nav-link">
                <i data-lucide="bar-chart-3" class="nav-icon"></i>
                System Analytics
            </a>
        </div>
        
        <div class="nav-section">
            <div class="nav-title">Management</div>
            <a href="agency-management.html" class="nav-link">
                <i data-lucide="building-2" class="nav-icon"></i>
                Agency Management
            </a>
            <a href="user-administration.html" class="nav-link">
                <i data-lucide="users" class="nav-icon"></i>
                User Administration
            </a>
            <a href="revenue-management.html" class="nav-link">
                <i data-lucide="dollar-sign" class="nav-icon"></i>
                Revenue Management
            </a>
        </div>
        
        <div class="nav-section">
            <div class="nav-title">Configuration</div>
            <a href="settings.html" class="nav-link">
                <i data-lucide="settings" class="nav-icon"></i>
                Settings
            </a>
        </div>
    </nav>

    <!-- Main Content -->
    <main class="main">
        <div class="container">
            <!-- Page Header -->
            <div class="page-header">
                <h1 class="page-title">System Dashboard</h1>
                <p class="page-subtitle">Monitor system performance and manage platform operations</p>
            </div>

            <!-- System Stats -->
            <div class="grid grid-4">
                <div class="stat-card">
                    <div class="stat-icon">
                        <i data-lucide="users"></i>
                    </div>
                    <div class="stat-content">
                        <div class="stat-value" id="totalUsers">0</div>
                        <div class="stat-label">Total Users</div>
                        <div class="stat-change positive">+12% from last month</div>
                    </div>
                </div>
                
                <div class="stat-card">
                    <div class="stat-icon">
                        <i data-lucide="building-2"></i>
                    </div>
                    <div class="stat-content">
                        <div class="stat-value" id="totalAgencies">0</div>
                        <div class="stat-label">Active Agencies</div>
                        <div class="stat-change positive">+3 new this month</div>
                    </div>
                </div>
                
                <div class="stat-card">
                    <div class="stat-icon">
                        <i data-lucide="dollar-sign"></i>
                    </div>
                    <div class="stat-content">
                        <div class="stat-value" id="totalRevenue">$0</div>
                        <div class="stat-label">Monthly Revenue</div>
                        <div class="stat-change positive">+18% from last month</div>
                    </div>
                </div>
                
                <div class="stat-card">
                    <div class="stat-icon">
                        <i data-lucide="activity"></i>
                    </div>
                    <div class="stat-content">
                        <div class="stat-value" id="systemUptime">99.9%</div>
                        <div class="stat-label">System Uptime</div>
                        <div class="stat-change positive">All systems operational</div>
                    </div>
                </div>
            </div>

            <!-- System Overview -->
            <div class="grid grid-2">
                <!-- Activity Feed -->
                <div class="card">
                    <div class="card-header">
                        <h3 class="card-title">
                            <i data-lucide="activity" class="card-icon"></i>
                            Recent Activity
                        </h3>
                        <button class="btn btn-secondary btn-sm">View All</button>
                    </div>
                    <div class="activity-feed" id="activityFeed">
                        <div class="loading">Loading activities...</div>
                    </div>
                </div>

                <!-- System Health -->
                <div class="card">
                    <div class="card-header">
                        <h3 class="card-title">
                            <i data-lucide="heart-pulse" class="card-icon"></i>
                            System Health
                        </h3>
                    </div>
                    <div class="health-metrics" id="healthMetrics">
                        <div class="loading">Loading health metrics...</div>
                    </div>
                </div>
            </div>

            <!-- Performance Charts -->
            <div class="card">
                <div class="card-header">
                    <h3 class="card-title">
                        <i data-lucide="trending-up" class="card-icon"></i>
                        Performance Analytics
                    </h3>
                    <div class="card-actions">
                        <select id="chartPeriod" class="form-select">
                            <option value="7d">Last 7 Days</option>
                            <option value="30d" selected>Last 30 Days</option>
                            <option value="90d">Last 3 Months</option>
                        </select>
                    </div>
                </div>
                <div style="position: relative; height: 400px; margin-top: 1rem;">
                    <canvas id="performanceChart"></canvas>
                </div>
            </div>

            <!-- Quick Actions -->
            <div class="card">
                <div class="card-header">
                    <h3 class="card-title">
                        <i data-lucide="zap" class="card-icon"></i>
                        Quick Actions
                    </h3>
                </div>
                <div class="quick-actions">
                    <button class="btn btn-primary" onclick="createNewUser()">
                        <i data-lucide="user-plus"></i>
                        Create User
                    </button>
                    <button class="btn btn-primary" onclick="addNewAgency()">
                        <i data-lucide="building-2"></i>
                        Add Agency
                    </button>
                    <button class="btn btn-warning" onclick="runSystemMaintenance()">
                        <i data-lucide="wrench"></i>
                        System Maintenance
                    </button>
                    <button class="btn btn-info" onclick="generateReport()">
                        <i data-lucide="file-text"></i>
                        Generate Report
                    </button>
                </div>
            </div>
        </div>
    </main>

    <script>
        // Dashboard data
        let dashboardData = {
            users: 0,
            agencies: 0,
            revenue: 0,
            activities: [],
            healthMetrics: {}
        };

        // Initialize dashboard on page load
        document.addEventListener('DOMContentLoaded', function() {
            // Initialize Lucide icons
            lucide.createIcons();
            
            // Load dashboard data
            loadDashboardData();
            
            // Initialize performance chart
            initializePerformanceChart();
        });

        async function loadDashboardData() {
            try {
                const response = await fetch('/api/super-admin/dashboard', {
                    headers: {
                        'Authorization': `Bearer ${localStorage.getItem('syncedup_token')}`,
                        'Content-Type': 'application/json'
                    }
                });

                if (response.ok) {
                    dashboardData = await response.json();
                    updateDashboard();
                } else {
                    console.error('Failed to load dashboard data');
                    loadFallbackData();
                }
            } catch (error) {
                console.error('Error loading dashboard data:', error);
                loadFallbackData();
            }
        }

        function loadFallbackData() {
            dashboardData = {
                users: 1247,
                agencies: 23,
                revenue: 89750,
                activities: [
                    { type: 'user_created', message: 'New user Sarah Johnson created', timestamp: new Date().toISOString() },
                    { type: 'agency_added', message: 'New agency "Metro Insurance" onboarded', timestamp: new Date(Date.now() - 3600000).toISOString() },
                    { type: 'system_update', message: 'System maintenance completed successfully', timestamp: new Date(Date.now() - 7200000).toISOString() }
                ],
                healthMetrics: {
                    cpu: 23,
                    memory: 67,
                    disk: 45,
                    network: 89
                }
            };
            updateDashboard();
        }

        function updateDashboard() {
            // Update stats
            document.getElementById('totalUsers').textContent = dashboardData.users.toLocaleString();
            document.getElementById('totalAgencies').textContent = dashboardData.agencies.toLocaleString();
            document.getElementById('totalRevenue').textContent = `$${dashboardData.revenue.toLocaleString()}`;

            // Update activity feed
            updateActivityFeed();
            
            // Update health metrics
            updateHealthMetrics();
        }

        function updateActivityFeed() {
            const feed = document.getElementById('activityFeed');
            if (!dashboardData.activities || dashboardData.activities.length === 0) {
                feed.innerHTML = '<div class="empty-state">No recent activities</div>';
                return;
            }

            feed.innerHTML = dashboardData.activities.map(activity => `
                <div class="activity-item">
                    <div class="activity-icon">
                        <i data-lucide="${getActivityIcon(activity.type)}"></i>
                    </div>
                    <div class="activity-content">
                        <div class="activity-message">${activity.message}</div>
                        <div class="activity-time">${formatTime(activity.timestamp)}</div>
                    </div>
                </div>
            `).join('');

            lucide.createIcons();
        }

        function updateHealthMetrics() {
            const container = document.getElementById('healthMetrics');
            if (!dashboardData.healthMetrics) {
                container.innerHTML = '<div class="empty-state">Health metrics unavailable</div>';
                return;
            }

            const metrics = dashboardData.healthMetrics;
            container.innerHTML = `
                <div class="health-grid">
                    <div class="health-metric">
                        <div class="health-label">CPU Usage</div>
                        <div class="health-bar">
                            <div class="health-fill" style="width: ${metrics.cpu}%; background: ${getHealthColor(metrics.cpu)}"></div>
                        </div>
                        <div class="health-value">${metrics.cpu}%</div>
                    </div>
                    <div class="health-metric">
                        <div class="health-label">Memory Usage</div>
                        <div class="health-bar">
                            <div class="health-fill" style="width: ${metrics.memory}%; background: ${getHealthColor(metrics.memory)}"></div>
                        </div>
                        <div class="health-value">${metrics.memory}%</div>
                    </div>
                    <div class="health-metric">
                        <div class="health-label">Disk Usage</div>
                        <div class="health-bar">
                            <div class="health-fill" style="width: ${metrics.disk}%; background: ${getHealthColor(metrics.disk)}"></div>
                        </div>
                        <div class="health-value">${metrics.disk}%</div>
                    </div>
                    <div class="health-metric">
                        <div class="health-label">Network Load</div>
                        <div class="health-bar">
                            <div class="health-fill" style="width: ${metrics.network}%; background: ${getHealthColor(metrics.network)}"></div>
                        </div>
                        <div class="health-value">${metrics.network}%</div>
                    </div>
                </div>
            `;
        }

        function initializePerformanceChart() {
            const ctx = document.getElementById('performanceChart').getContext('2d');
            
            // Generate sample data
            const labels = [];
            const userData = [];
            const revenueData = [];
            
            for (let i = 29; i >= 0; i--) {
                const date = new Date();
                date.setDate(date.getDate() - i);
                labels.push(date.toLocaleDateString('en-US', { month: 'short', day: 'numeric' }));
                userData.push(Math.floor(Math.random() * 100) + 800);
                revenueData.push(Math.floor(Math.random() * 5000) + 2000);
            }

            new Chart(ctx, {
                type: 'line',
                data: {
                    labels: labels,
                    datasets: [
                        {
                            label: 'Daily Users',
                            data: userData,
                            borderColor: '#ffd700',
                            backgroundColor: 'rgba(255, 215, 0, 0.1)',
                            tension: 0.4,
                            yAxisID: 'y'
                        },
                        {
                            label: 'Daily Revenue',
                            data: revenueData,
                            borderColor: '#3b82f6',
                            backgroundColor: 'rgba(59, 130, 246, 0.1)',
                            tension: 0.4,
                            yAxisID: 'y1'
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            labels: { color: '#ffffff' }
                        }
                    },
                    scales: {
                        x: {
                            ticks: { color: '#cccccc' },
                            grid: { color: '#444444' }
                        },
                        y: {
                            type: 'linear',
                            display: true,
                            position: 'left',
                            ticks: { color: '#cccccc' },
                            grid: { color: '#444444' }
                        },
                        y1: {
                            type: 'linear',
                            display: true,
                            position: 'right',
                            ticks: { color: '#cccccc' },
                            grid: { drawOnChartArea: false }
                        }
                    }
                }
            });
        }

        // Utility functions
        function getActivityIcon(type) {
            const icons = {
                user_created: 'user-plus',
                agency_added: 'building-2',
                system_update: 'wrench',
                default: 'activity'
            };
            return icons[type] || icons.default;
        }

        function getHealthColor(value) {
            if (value < 30) return 'var(--success)';
            if (value < 70) return 'var(--warning)';
            return 'var(--error)';
        }

        function formatTime(timestamp) {
            const date = new Date(timestamp);
            const now = new Date();
            const diff = now - date;
            
            if (diff < 3600000) { // Less than 1 hour
                return `${Math.floor(diff / 60000)} minutes ago`;
            } else if (diff < 86400000) { // Less than 1 day
                return `${Math.floor(diff / 3600000)} hours ago`;
            } else {
                return date.toLocaleDateString();
            }
        }

        // Quick action functions
        function createNewUser() {
            window.location.href = '/super-admin/user-administration.html?action=create';
        }

        function addNewAgency() {
            window.location.href = '/super-admin/agency-management.html?action=create';
        }

        function runSystemMaintenance() {
            if (confirm('Are you sure you want to run system maintenance? This may temporarily affect system performance.')) {
                // Implement system maintenance logic
                alert('System maintenance initiated. You will be notified when complete.');
            }
        }

        function generateReport() {
            window.location.href = '/super-admin/system-analytics.html?action=generate';
        }

        function logout() {
            localStorage.clear();
            window.location.href = '/login.html';
        }
    </script>
</body>
</html>